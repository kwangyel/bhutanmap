{"version":3,"sources":["../../../api/server/utils/cache.js"],"names":["Redis","require","redis","process","env","REDIS_PORT","REDIS_HOST","util","Util","module","exports","checkResponseCache","req","res","next","console","log","get","originalUrl","cachedResponse","setSuccess","JSON","parse","send","addResponseToCache","data","tocache","set","stringify"],"mappings":";;;;;;;;AAEA;;AAFA,IAAMA,KAAK,GAAGC,OAAO,CAAC,SAAD,CAArB;;AACA,IAAMC,KAAK,GAAG,IAAIF,KAAJ,CAAUG,OAAO,CAACC,GAAR,CAAYC,UAAtB,EAAkCF,OAAO,CAACC,GAAR,CAAYE,UAA9C,CAAd;AAGA,IAAMC,IAAI,GAAC,IAAIC,iBAAJ,EAAX;AAEAC,MAAM,CAACC,OAAP,GAAiB;AACf;AACMC,EAAAA,kBAFS;AAAA;AAAA;AAAA,kDAEWC,GAFX,EAEeC,GAFf,EAEoBC,IAFpB;AAAA;AAAA;AAAA;AAAA;AAAA;AAGbC,cAAAA,OAAO,CAACC,GAAR,CAAY,oBAAZ;AAHa;AAAA,qBAIgBd,KAAK,CAACe,GAAN,CAAUL,GAAG,CAACM,WAAd,CAJhB;;AAAA;AAIPC,cAAAA,cAJO;;AAKb,kBAAGA,cAAH,EAAkB;AAChBZ,gBAAAA,IAAI,CAACa,UAAL,CAAgB,GAAhB,EAAoB,4BAApB,EAAiDC,IAAI,CAACC,KAAL,CAAWH,cAAX,CAAjD;AACAZ,gBAAAA,IAAI,CAACgB,IAAL,CAAUV,GAAV;AACD,eAHD,MAGK;AACHC,gBAAAA,IAAI;AACL;;AAVY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAYf;AACMU,EAAAA,kBAbS;AAAA;AAAA;AAAA,mDAaWZ,GAbX,EAaeC,GAbf,EAaoBC,IAbpB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAeVF,GAAG,CAACa,IAfM;AAAA;AAAA;AAAA;;AAgBPC,cAAAA,OAhBO,GAgBCd,GAAG,CAACa,IAhBL;AAAA;AAAA,qBAiBLvB,KAAK,CAACyB,GAAN,CAAUf,GAAG,CAACM,WAAd,EAA0BG,IAAI,CAACO,SAAL,CAAehB,GAAG,CAACa,IAAnB,CAA1B,CAjBK;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,CAAjB","sourcesContent":["const Redis = require('ioredis');\nconst redis = new Redis(process.env.REDIS_PORT, process.env.REDIS_HOST);\nimport Util from '../utils/Utils';\n\nconst util=new Util();\n\nmodule.exports = {\n  /** Koa middleware function to check cache before continuing to any endpoint handlers */\n  async checkResponseCache (req,res, next) {\n    console.log('checkResponseCache');\n    const cachedResponse = await redis.get(req.originalUrl);\n    if(cachedResponse){\n      util.setSuccess(200,'Pests Retrieved from cache',JSON.parse(cachedResponse));\n      util.send(res);\n    }else{\n      next();\n    }\n  },\n  /** Koa middleware function to insert response into cache */\n  async addResponseToCache (req,res, next) {\n    // console.log(JSON.stringify(req.data));\n    if(req.data){\n      var tocache=req.data;\n      await redis.set(req.originalUrl,JSON.stringify(req.data));\n    }\n  }\n}\n"],"file":"cache.js"}